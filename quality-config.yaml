# Quality Gates Configuration - Comprehensive Build & Test Infrastructure
# Enforces 85% minimum coverage (90-100% ideal), parallel PR validation, sequential release builds
# Includes flaky detection, timeouts, performance monitoring, and automated remediation

quality_gates:
  code_coverage:
    minimum: 85  # Hard requirement - blocks CI merge
    target: 90   # Ideal target for recognition
    aspirational: 100  # Excellence target
    block_ci: true  # Enforce minimum threshold
    incremental_requirement: 90  # New code must have 90%+

  test_performance:
    max_duration_seconds: 30  # Unit tests
    max_integration_duration_seconds: 120  # Integration tests
    max_ui_duration_seconds: 180  # UI tests
    timeout_buffer_percent: 50  # Allow 50% buffer before timeout

  build_performance:
    max_duration_seconds: 120  # Individual project builds
    max_sequential_duration_seconds: 600  # Complete workspace sequential
    pr_validation_target_seconds: 600  # <10 minutes parallel PR validation
    release_build_target_seconds: 900  # <15 minutes sequential releases

  flaky_test_detection:
    auto_skip_threshold: 3  # 3 failures in 5 runs = auto-skip
    block_ci_threshold: 5   # 5 consecutive failures = block CI
    max_iterations: 5       # Test runs for flaky detection
    quarantine_days: 7      # Auto-skip duration

  timeout_management:
    circuit_breaker_trips: 3    # Consecutive failures trigger circuit breaker
    circuit_breaker_reset_minutes: 5  # Half-open state duration
    emergency_skip_timeout_seconds: 300  # Emergency skip for stuck processes
    retry_attempts: 3           # Test retry attempts
    retry_backoff_seconds: [1, 2, 4]  # Exponential backoff

  code_quality:
    max_warnings: 5
    max_errors: 0
    swiftlint_strict: true
    swiftformat_check: true

  file_limits:
    max_file_size_kb: 1000
    max_lines_per_file: 500
    max_complexity_cyclomatic: 10
    max_complexity_cognitive: 15

  security:
    audit_required: true
    encryption_validation: true
    privacy_compliance_check: true

project_specific:
  CodingReviewer:
    test_coverage_minimum: 85
    max_file_uploads: 1000
    security_framework_validation: true
    performance_target_ms: 500

  AvoidObstaclesGame:
    test_coverage_minimum: 85
    game_performance_target_fps: 60
    memory_usage_limit_mb: 100

  PlannerApp:
    test_coverage_minimum: 85
    cloudkit_sync_timeout_seconds: 30
    ui_responsiveness_target_ms: 100

  MomentumFinance:
    test_coverage_minimum: 85
    data_integrity_checks: true
    financial_calculation_precision: 0.01

  HabitQuest:
    test_coverage_minimum: 85
    habit_tracking_accuracy: 99.9
    notification_delivery_target_ms: 100

ci_strategy:
  pr_validation:
    execution: parallel
    max_concurrent_jobs: 5
    timeout_minutes: 10
    target_completion_minutes: 8
    resource_optimization: true
    fast_feedback: true

  release_builds:
    execution: sequential
    timeout_minutes: 15
    target_completion_minutes: 12
    comprehensive_validation: true
    stability_priority: true

automated_remediation:
  issue_filing:
    enabled: true
    max_issues_per_hour: 10
    auto_assign: true
    priority_mapping:
      coverage_below_minimum: high
      build_timeout: critical
      flaky_test_blocked: high
      security_violation: critical

  self_healing:
    enabled: true
    known_patterns_recognition: true
    auto_fix_attempts: 3
    success_rate_tracking: true

monitoring:
  performance_tracking:
    enabled: true
    metrics_retention_days: 90
    regression_alerts: true
    dashboard_integration: true

  flaky_test_registry:
    enabled: true
    auto_cleanup_days: 30
    quarantine_management: true

  build_analytics:
    enabled: true
    bottleneck_detection: true
    optimization_recommendations: true
