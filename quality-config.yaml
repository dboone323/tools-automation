# Quality Gates Configuration
quality_gates:
  code_coverage:
    minimum: 85  # Hard requirement - CI blocks below this
    target: 90   # Ideal target
    aspirational: 100
    block_ci: true
    incremental_requirement: 90  # New code must have 90%+
    regression_threshold: 2  # Alert on coverage drops >2%

  test_performance:
    max_duration_seconds: 30
    unit_tests_max: 60
    integration_tests_max: 120
    ui_tests_max: 180

  build_performance:
    max_duration_seconds: 120
    per_project_max: 180  # 50% buffer
    total_sequential_max: 600
    pr_parallel_max: 600  # 10 minutes
    release_sequential_max: 900  # 15 minutes

  code_quality:
    max_warnings: 5
    max_errors: 0

  file_limits:
    max_file_size_kb: 1000
    max_lines_per_file: 500

  complexity:
    max_cyclomatic_complexity: 10
    max_cognitive_complexity: 15

  test_reliability:
    flaky_test_threshold: 3  # Auto-skip after 3 failures in 5 runs
    critical_failure_threshold: 5  # Block CI after 5 consecutive failures
    max_retry_attempts: 3
    retry_backoff_seconds: [1, 2, 4]  # Exponential backoff
    flaky_skip_max_days: 7  # Maximum days a test can be skipped

  ci_strategy:
    pr_validation: "parallel"  # Fast feedback for pull requests
    release_builds: "sequential"  # Stable, comprehensive validation
    
  performance_regression:
    alert_threshold_percent: 10  # Alert on >10% slowdown
    auto_block: true

project_specific:
  CodingReviewer:
    test_coverage_minimum: 85  # Updated to workspace standard
    max_file_uploads: 1000

  HabitQuest:
    test_coverage_minimum: 85  # Updated to workspace standard
    performance_target_ms: 100

  MomentumFinance:
    test_coverage_minimum: 85
    data_integrity_checks: true
  
  PlannerApp:
    test_coverage_minimum: 85
    cloudkit_integration_tests: true
  
  AvoidObstaclesGame:
    test_coverage_minimum: 85
    game_logic_tests_required: true

# Critical components requiring 100% coverage
critical_components:
  agents:
    path: "Tools/Automation/agents"
    coverage_minimum: 100
    block_ci: true
    description: "Agent scripts must have full test coverage"
  
  workflows:
    paths:
      - "Tools/Automation/local_ci_orchestrator.sh"
      - "Tools/Automation/master_automation.sh"
      - "Tools/Automation/setup_free_only.sh"
      - ".github/workflows"
    coverage_minimum: 100
    block_ci: true
    description: "CI/CD workflows must have full test coverage"
  
  ai_components:
    paths:
      - "**/AI*.swift"
      - "**/Ollama*.swift"
      - "**/HuggingFace*.swift"
      - "**/ML*.swift"
      - "Tools/Automation/*ai*.py"
      - "Tools/Automation/*ollama*.py"
    coverage_minimum: 100
    block_ci: true
    description: "AI/ML components must have full test coverage"

# Coverage enforcement rules
coverage_enforcement:
  fail_on_coverage_decrease: true
  minimum_new_code_coverage: 90
  allow_coverage_decrease_percent: 0  # No decrease allowed
  coverage_trend_monitoring: true
  generate_coverage_badge: true
  coverage_report_formats:
    - markdown
    - html
    - json
  store_historical_coverage: true
  historical_coverage_path: "~/.quantum-workspace/artifacts/baselines/coverage_history.json"
