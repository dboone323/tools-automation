---
name: "Dependency Updates"

on:
  schedule:
    - cron: '0 6 * * 0' # weekly on Sunday at 06:00 UTC
  workflow_dispatch: {}

jobs:
  check:
    name: Check and report dependency status
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check SwiftLint version (non-fatal)
        shell: bash
        run: |
          set -euo pipefail
          current_version=$(swiftlint version 2>/dev/null || echo "not installed")
          echo "Current SwiftLint version: $current_version"
          latest_version=$(curl -sSfL https://api.github.com/repos/realm/SwiftLint/releases/latest | jq -r .tag_name)
          echo "Latest SwiftLint version: $latest_version"
          if [[ "$current_version" != "$latest_version" ]]; then
            echo "SwiftLint update available: $current_version -> $latest_version"
          else
            echo "SwiftLint up-to-date"
          fi

      - name: Sanity-check package manager files
        shell: bash
        run: |
          set -euo pipefail
          mkdir -p dependency_reports
          echo "Dependency check run at $(date)" > dependency_reports/dependency_check.log
          ls -la >> dependency_reports/dependency_check.log || true

      - name: Upload dependency report
        uses: actions/upload-artifact@v4
        with:
          name: dependency-report
          path: dependency_reports
