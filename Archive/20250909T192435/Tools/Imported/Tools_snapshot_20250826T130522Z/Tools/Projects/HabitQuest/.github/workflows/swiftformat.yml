---
name: "SwiftFormat Check"

on:
  pull_request:
    branches: [ main, develop ]
    paths:
      - '**/*.swift'

jobs:
  swiftformat:
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install SwiftFormat (best-effort)
        shell: bash
        run: |
          set -euo pipefail
          brew install swiftformat || true

      - name: Ensure .swiftformat exists
        shell: bash
        run: |
          set -euo pipefail
          if [ ! -f .swiftformat ]; then
            echo "# default swiftformat rules" > .swiftformat
          fi

      - name: Run swiftformat lint (non-fatal)
        shell: bash
        run: |
          set -euo pipefail
          REPORT_DIR=swiftformat_reports
          mkdir -p "$REPORT_DIR"
          if command -v swiftformat >/dev/null 2>&1; then
            if swiftformat . --config .swiftformat --lint --verbose > "$REPORT_DIR/lint.txt" 2>&1; then
              echo "All Swift files are properly formatted" > "$REPORT_DIR/summary.txt"
            else
              echo "Some files need formatting" > "$REPORT_DIR/summary.txt"
            fi
          else
            echo "swiftformat not available; skipped" > "$REPORT_DIR/summary.txt"
          fi

      - name: Upload swiftformat reports
        uses: actions/upload-artifact@v4
        with:
          name: swiftformat-report
          path: swiftformat_reports
